<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FC Mobile Rivalry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@300;400;600;700&family=Inter:wght@400;500;600&display=swap');

        :root {
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-bg: rgba(15, 23, 42, 0.6);
            --neon-spurs: #34d399; /* emerald-400 */
            --neon-city: #38bdf8;  /* sky-400 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            background-image: 
                radial-gradient(circle at 50% 0%, #1e293b 0%, #000 70%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        /* Subtle grid pattern overlay */
        .bg-grid-pattern {
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }
        
        h1, h2, h3, .stat-value, .score-font {
            font-family: 'Teko', sans-serif;
            letter-spacing: 0.05em;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card-hover:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
        }

        .spurs-glow:hover {
            box-shadow: 0 0 30px -5px rgba(52, 211, 153, 0.15);
            border-color: rgba(52, 211, 153, 0.3);
        }

        .city-glow:hover {
            box-shadow: 0 0 30px -5px rgba(56, 189, 248, 0.15);
            border-color: rgba(56, 189, 248, 0.3);
        }

        /* Calendar Styling */
        .calendar-day {
            transition: all 0.2s ease;
        }
        .calendar-day:hover:not(.empty) {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.3);
            cursor: pointer;
        }
        
        .pulse-ring {
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(52, 211, 153, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0); }
        }

        /* Digital Input Styling */
        .digital-input {
            font-family: 'Teko', sans-serif;
            background: #0f172a;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }

        /* Remove Spinners from Number Input */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield; /* Firefox */
        }
    </style>
</head>
<body class="flex flex-col items-center py-6 px-4 md:px-8 relative overflow-x-hidden">

    <!-- Background Decoration -->
    <div class="fixed inset-0 bg-grid-pattern pointer-events-none z-0"></div>

    <!-- Main Container -->
    <div class="w-full max-w-5xl z-10 space-y-8">
        
        <!-- Header -->
        <header class="text-center relative">
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-32 bg-emerald-500/20 blur-[80px] rounded-full pointer-events-none"></div>
            
            <div class="relative inline-flex items-center space-x-3 text-emerald-400 mb-2 bg-emerald-950/30 px-4 py-1.5 rounded-full border border-emerald-500/20 backdrop-blur-sm">
                <i data-lucide="gamepad-2" class="w-4 h-4"></i>
                <span class="text-xs font-bold tracking-[0.2em] uppercase">FC Mobile Companion</span>
            </div>
            
            <h1 class="text-6xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-400 mt-4 mb-1">RIVALRY TABLE</h1>
            <div class="flex items-center justify-center gap-3 text-slate-400 text-sm font-medium tracking-wide">
                <span class="text-white">Tottenham</span>
                <span class="text-slate-600">vs</span>
                <span class="text-sky-400">Man City</span>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            
            <!-- SPURS CARD -->
            <div class="md:col-span-4 glass-panel glass-card-hover spurs-glow rounded-3xl p-6 text-center relative overflow-hidden group">
                <div class="absolute -right-6 -top-6 text-emerald-500/5 group-hover:text-emerald-500/10 transition-colors duration-500">
                    <i data-lucide="shield" class="w-40 h-40"></i>
                </div>
                
                <div class="relative z-10">
                    <h2 class="text-3xl text-emerald-400 mb-1 drop-shadow-[0_0_10px_rgba(52,211,153,0.3)]">TOTTENHAM</h2>
                    <div class="text-7xl font-bold text-white leading-none mb-1" id="total-p1-goals">0</div>
                    <p class="text-xs text-slate-500 uppercase tracking-widest font-semibold mb-6">Total Goals Scored</p>
                    
                    <div class="inline-flex items-center bg-emerald-950/40 border border-emerald-500/20 rounded-xl px-4 py-2">
                        <span class="text-xs text-emerald-200 mr-2 uppercase tracking-wider">Victories</span>
                        <span id="p1-wins" class="text-2xl font-bold text-emerald-400 leading-none">0</span>
                    </div>
                </div>
            </div>

            <!-- AGGREGATE CENTER -->
            <div class="md:col-span-4 flex flex-col justify-center items-center space-y-4 py-4 order-last md:order-none">
                <div class="text-sm font-bold tracking-[0.3em] text-slate-500 uppercase">Current Aggregate</div>
                
                <div class="glass-panel px-10 py-6 rounded-full border border-slate-700/50 shadow-2xl relative group">
                    <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-sky-500/10 rounded-full opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <span class="relative text-5xl md:text-6xl font-bold text-white tracking-tight tabular-nums drop-shadow-lg" id="agg-score">0 : 0</span>
                </div>
                
                <div class="flex items-center gap-2 text-xs text-slate-400 bg-slate-900/50 px-3 py-1 rounded-full border border-slate-800">
                    <i data-lucide="history" class="w-3 h-3"></i>
                    <span>Total Matches: <span id="total-matches" class="text-white font-bold">0</span></span>
                </div>
            </div>

            <!-- CITY CARD -->
            <div class="md:col-span-4 glass-panel glass-card-hover city-glow rounded-3xl p-6 text-center relative overflow-hidden group">
                <div class="absolute -left-6 -top-6 text-sky-500/5 group-hover:text-sky-500/10 transition-colors duration-500">
                    <i data-lucide="swords" class="w-40 h-40"></i>
                </div>
                
                <div class="relative z-10">
                    <h2 class="text-3xl text-sky-400 mb-1 drop-shadow-[0_0_10px_rgba(56,189,248,0.3)]">MAN CITY</h2>
                    <div class="text-7xl font-bold text-white leading-none mb-1" id="total-p2-goals">0</div>
                    <p class="text-xs text-slate-500 uppercase tracking-widest font-semibold mb-6">Total Goals Scored</p>
                    
                    <div class="inline-flex items-center bg-sky-950/40 border border-sky-500/20 rounded-xl px-4 py-2">
                        <span class="text-xs text-sky-200 mr-2 uppercase tracking-wider">Victories</span>
                        <span id="p2-wins" class="text-2xl font-bold text-sky-400 leading-none">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="glass-panel rounded-3xl p-6 md:p-8 relative overflow-hidden">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8 relative z-10">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-emerald-500/10 rounded-lg text-emerald-400">
                        <i data-lucide="calendar" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-white" id="current-month-display">Month Year</h3>
                </div>
                
                <div class="flex space-x-1 bg-slate-800/50 p-1 rounded-lg border border-slate-700">
                    <button onclick="changeMonth(-1)" class="p-2 hover:bg-slate-700 text-slate-400 hover:text-white rounded-md transition"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                    <button onclick="changeMonth(1)" class="p-2 hover:bg-slate-700 text-slate-400 hover:text-white rounded-md transition"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                </div>
            </div>

            <!-- Grid Header -->
            <div class="grid grid-cols-7 gap-2 mb-4 text-center">
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Sun</div>
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Mon</div>
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Tue</div>
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Wed</div>
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Thu</div>
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Fri</div>
                <div class="text-xs font-bold text-slate-600 uppercase tracking-widest">Sat</div>
            </div>

            <!-- Calendar Grid -->
            <div id="calendar-grid" class="grid grid-cols-7 gap-2 md:gap-3 relative z-10">
                <!-- JS Populated -->
            </div>
        </div>
    </div>

    <!-- Match Detail Modal -->
    <div id="match-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md hidden opacity-0 transition-opacity duration-300 px-4 py-6">
        <!-- Changed: max-w-xl, max-h-[85vh], flex flex-col for adaptive full-screen feel -->
        <div class="glass-panel border-slate-700 rounded-2xl w-full max-w-xl md:max-w-2xl shadow-2xl transform scale-95 transition-all duration-300 overflow-hidden flex flex-col max-h-[85vh]" id="modal-content">
            
            <!-- Modal Header -->
            <div class="bg-slate-900/50 px-6 py-5 border-b border-slate-700 flex justify-between items-start flex-shrink-0">
                <div>
                    <h3 class="text-3xl font-bold text-white leading-none" id="modal-date-title">Date</h3>
                    <p class="text-slate-400 text-xs font-medium uppercase tracking-wider mt-1" id="modal-status">Viewing History</p>
                </div>
                <button onclick="closeModal()" class="text-slate-500 hover:text-white transition bg-slate-800/50 hover:bg-slate-700 p-2 rounded-lg">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Matches List (Adaptive Area) -->
            <!-- Changed: Removed fixed max-h, added flex-1 and overflow-y-auto to fill space -->
            <div class="p-4 md:p-6 flex-1 overflow-y-auto custom-scrollbar bg-black/20">
                <div id="matches-list" class="space-y-3 pb-2">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Input Form (Footer) -->
            <div id="add-match-form" class="bg-slate-900/80 px-6 py-6 border-t border-slate-700 flex-shrink-0 z-20 shadow-[0_-10px_40px_rgba(0,0,0,0.3)]">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="text-xs font-bold text-emerald-400 uppercase tracking-widest">New Match Result</h4>
                </div>
                
                <div class="flex items-center justify-between gap-4 mb-4">
                    <div class="flex-1 relative group">
                        <label class="absolute -top-2 left-2 text-[10px] bg-slate-900 px-2 text-emerald-400 font-bold uppercase z-10">Spurs</label>
                        <input type="number" id="input-p1" min="0" placeholder="0" 
                            class="digital-input w-full bg-slate-950 border border-slate-700 rounded-xl py-4 px-0 text-center text-4xl text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition-all placeholder-slate-700">
                    </div>
                    
                    <span class="text-slate-600 font-bold text-3xl pb-2 px-2">:</span>
                    
                    <div class="flex-1 relative">
                        <label class="absolute -top-2 left-2 text-[10px] bg-slate-900 px-2 text-sky-400 font-bold uppercase z-10">City</label>
                        <input type="number" id="input-p2" min="0" placeholder="0" 
                            class="digital-input w-full bg-slate-950 border border-slate-700 rounded-xl py-4 px-0 text-center text-4xl text-white focus:border-sky-500 focus:ring-1 focus:ring-sky-500 outline-none transition-all placeholder-slate-700">
                    </div>
                </div>

                <button onclick="addMatch()" class="w-full bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 transition shadow-lg shadow-emerald-900/50 active:scale-[0.98]">
                    <i data-lucide="plus-circle" class="w-6 h-6"></i>
                    <span class="tracking-wide text-lg">RECORD SCORE</span>
                </button>
            </div>
            
            <!-- Locked State Footer -->
            <div id="locked-message" class="hidden bg-slate-900/50 px-6 py-8 border-t border-slate-700 text-center flex-shrink-0">
                <p class="text-amber-500/80 text-base font-medium flex items-center justify-center gap-2 bg-amber-950/20 py-3 px-4 rounded-xl border border-amber-900/30">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                    Match day closed. History is locked.
                </p>
            </div>

        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/95 backdrop-blur-md hidden opacity-0 transition-opacity duration-300 px-4">
        <div class="glass-panel border-red-900/30 rounded-2xl p-8 shadow-2xl transform scale-95 transition-transform duration-300 w-full max-w-sm text-center" id="delete-modal-content">
            <div class="mb-5 text-red-500 flex justify-center bg-red-500/10 w-16 h-16 rounded-full items-center mx-auto border border-red-500/20 shadow-[0_0_15px_rgba(239,68,68,0.2)]">
                <i data-lucide="trash-2" class="w-8 h-8"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-2 tracking-wide">Delete Score?</h3>
            <p class="text-slate-400 text-sm mb-8 leading-relaxed">This match result will be permanently removed from your stats.</p>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="closeDeleteModal()" class="px-4 py-3 bg-slate-800 hover:bg-slate-700 text-white font-medium rounded-xl transition border border-slate-700">Cancel</button>
                <button onclick="confirmDelete()" class="px-4 py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded-xl transition shadow-lg shadow-red-900/40">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration & State ---
        const TEAMS = { p1: "Tottenham", p2: "City" };
        let currentDate = new Date(); 
        let selectedDateKey = null;   
        let historyData = {};         
        let matchIndexToDelete = -1;  

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadData();
            
            renderCalendar();
            updateDashboard();
        });

        // --- Data Management ---
        function loadData() {
            const saved = localStorage.getItem('fc_rivalry_data');
            if (saved) {
                historyData = JSON.parse(saved);
            } else {
                seedInitialData();
            }
        }

        function saveData() {
            localStorage.setItem('fc_rivalry_data', JSON.stringify(historyData));
            updateDashboard();
            renderCalendar(); 
        }

        function seedInitialData() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const dayBeforeYesterday = new Date(today);
            dayBeforeYesterday.setDate(dayBeforeYesterday.getDate() - 2);

            const yestKey = formatDateKey(yesterday);
            const dayBeforeYestKey = formatDateKey(dayBeforeYesterday);

            historyData = {};

            historyData[dayBeforeYestKey] = [
                { p1: 2, p2: 3, timestamp: Date.now() - 172800000 }
            ];

            historyData[yestKey] = [
                { p1: 1, p2: 1, timestamp: Date.now() - 86400000 },
                { p1: 3, p2: 2, timestamp: Date.now() - 86399999 },
                { p1: 1, p2: 0, timestamp: Date.now() - 86399998 },
                { p1: 2, p2: 2, timestamp: Date.now() - 86399997 },
                { p1: 1, p2: 1, timestamp: Date.now() - 86399996 }
            ];
            
            saveData();
        }

        // --- Helper Functions ---
        function formatDateKey(dateObj) {
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getTodayKey() {
            return formatDateKey(new Date());
        }

        // --- Dashboard Logic ---
        function updateDashboard() {
            let p1Goals = 0, p2Goals = 0;
            let p1Wins = 0, p2Wins = 0, matches = 0;

            Object.values(historyData).forEach(dayMatches => {
                dayMatches.forEach(m => {
                    matches++;
                    p1Goals += parseInt(m.p1);
                    p2Goals += parseInt(m.p2);
                    if(m.p1 > m.p2) p1Wins++;
                    else if (m.p2 > m.p1) p2Wins++;
                });
            });

            document.getElementById('total-p1-goals').textContent = p1Goals;
            document.getElementById('total-p2-goals').textContent = p2Goals;
            document.getElementById('agg-score').textContent = `${p1Goals} : ${p2Goals}`;
            document.getElementById('p1-wins').textContent = p1Wins;
            document.getElementById('p2-wins').textContent = p2Wins;
            document.getElementById('total-matches').textContent = matches;
        }

        // --- Calendar Logic ---
        function changeMonth(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            renderCalendar();
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('current-month-display').innerText = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = "";

            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'p-4';
                grid.appendChild(empty);
            }

            const todayKey = getTodayKey();

            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(year, month, day);
                const dateKey = formatDateKey(dateObj);
                const hasData = historyData[dateKey] && historyData[dateKey].length > 0;
                
                const el = document.createElement('div');
                
                // Base Classes
                let classes = "group relative bg-slate-800/40 border border-slate-700/50 rounded-xl p-2 h-24 flex flex-col justify-between transition-all duration-300 hover:bg-slate-700/60 hover:border-slate-500/50 cursor-pointer overflow-hidden";
                
                // Today styling
                if (dateKey === todayKey) {
                    classes += " ring-1 ring-emerald-500/50 shadow-[0_0_15px_rgba(16,185,129,0.15)] pulse-ring";
                }

                el.className = classes;
                el.onclick = () => openModal(dateKey);

                // Date Number Style
                let numColor = dateKey === todayKey ? 'text-emerald-400' : 'text-slate-400 group-hover:text-white';
                let content = `<span class="font-bold text-lg ${numColor} z-10">${day}</span>`;
                
                // Background Highlight for today
                if(dateKey === todayKey) {
                     content += `<div class="absolute top-0 right-0 w-8 h-8 bg-emerald-500/20 blur-lg rounded-full -mr-2 -mt-2"></div>`;
                }

                // Match Indicators
                if (hasData) {
                    const count = historyData[dateKey].length;
                    let dayP1 = 0, dayP2 = 0;
                    historyData[dateKey].forEach(m => { dayP1+=m.p1; dayP2+=m.p2; });
                    
                    // Determine dominant color for the day bar
                    let barColor = "bg-slate-500";
                    if(dayP1 > dayP2) barColor = "bg-emerald-500";
                    else if(dayP2 > dayP1) barColor = "bg-sky-500";
                    else barColor = "bg-slate-400";

                    content += `
                        <div class="z-10">
                            <div class="flex items-center justify-between text-[10px] font-bold text-slate-300 mb-1.5 px-1">
                                <span class="${dayP1 > dayP2 ? 'text-emerald-400' : ''}">${dayP1}</span>
                                <span class="text-slate-600">-</span>
                                <span class="${dayP2 > dayP1 ? 'text-sky-400' : ''}">${dayP2}</span>
                            </div>
                            <div class="w-full h-1 bg-slate-700 rounded-full overflow-hidden">
                                <div class="h-full ${barColor} opacity-80" style="width: 100%"></div>
                            </div>
                        </div>
                    `;
                    
                    // Subtle background glow for days with activity
                    content += `<div class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-slate-900/80 to-transparent pointer-events-none"></div>`;
                } else if (dateKey === todayKey) {
                    content += `<div class="z-10 mt-auto text-[10px] text-emerald-500/80 font-medium tracking-wide text-center">PLAY</div>`;
                }

                el.innerHTML = content;
                grid.appendChild(el);
            }
        }

        // --- Modal & Form Logic ---
        function openModal(dateKey) {
            selectedDateKey = dateKey;
            const modal = document.getElementById('match-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);

            const d = new Date(selectedDateKey);
            document.getElementById('modal-date-title').innerText = d.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });

            const todayKey = getTodayKey();
            const isToday = (selectedDateKey === todayKey);
            const isFuture = (selectedDateKey > todayKey);

            const formDiv = document.getElementById('add-match-form');
            const lockedMsg = document.getElementById('locked-message');
            const statusTxt = document.getElementById('modal-status');

            if (isToday) {
                formDiv.classList.remove('hidden');
                lockedMsg.classList.add('hidden');
                statusTxt.innerText = "Active Game Day";
                statusTxt.className = "text-emerald-400 text-xs font-bold uppercase tracking-widest mt-1";
            } else {
                formDiv.classList.add('hidden');
                lockedMsg.classList.remove('hidden');
                if(isFuture) {
                    statusTxt.innerText = "Upcoming";
                    lockedMsg.innerHTML = `<p class="text-slate-400">Future date.</p>`;
                } else {
                    statusTxt.innerText = "Archive";
                    statusTxt.className = "text-slate-500 text-xs font-bold uppercase tracking-widest mt-1";
                    lockedMsg.innerHTML = `
                        <p class="text-amber-500/80 text-sm font-medium flex items-center justify-center gap-2 bg-amber-950/20 py-2 px-4 rounded-lg border border-amber-900/30">
                            <i data-lucide="lock" class="w-4 h-4"></i> Match day closed.
                        </p>`;
                }
            }

            renderMatchList();
        }

        function closeModal() {
            const modal = document.getElementById('match-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        function renderMatchList() {
            const list = document.getElementById('matches-list');
            list.innerHTML = "";
            
            const matches = historyData[selectedDateKey] || [];
            const isToday = (selectedDateKey === getTodayKey());

            if (matches.length === 0) {
                list.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 opacity-50">
                        <i data-lucide="ghost" class="w-8 h-8 mb-2 text-slate-500"></i>
                        <span class="text-sm text-slate-400 font-medium">No matches played</span>
                    </div>`;
                return;
            }

            matches.forEach((m, index) => {
                const p1Score = parseInt(m.p1);
                const p2Score = parseInt(m.p2);
                
                // Logic for row styling
                let rowBg = "bg-slate-800/50";
                let statusColor = "bg-slate-600";
                
                if(p1Score > p2Score) { 
                    statusColor = "bg-emerald-500"; 
                } else if (p2Score > p1Score) { 
                    statusColor = "bg-sky-500"; 
                }

                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 rounded-xl border border-slate-700/50 relative group transition hover:bg-slate-800 ${rowBg}`;
                
                // Delete button logic
                let deleteBtn = '';
                if (isToday) {
                    deleteBtn = `
                        <button onclick="deleteMatch(${index})" class="absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-all duration-200 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:scale-110 hover:bg-red-600 z-20">
                            <i data-lucide="trash-2" class="w-3 h-3"></i>
                        </button>
                    `;
                }

                // Responsive list layout: sides can shrink, center expands if needed for huge numbers
                div.innerHTML = `
                    <div class="flex items-center gap-3 flex-1 min-w-0">
                        <div class="w-1.5 h-8 rounded-full flex-shrink-0 ${p1Score > p2Score ? 'bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]' : 'bg-slate-700'}"></div>
                        <span class="font-bold text-slate-200 truncate">TOT</span>
                    </div>
                    
                    <div class="flex-shrink-0 mx-2">
                        <div class="font-mono text-xl md:text-2xl font-bold text-white tracking-widest tabular-nums bg-slate-950/50 px-3 md:px-4 py-1 rounded-lg border border-white/5">
                            <span class="${p1Score > p2Score ? 'text-emerald-400' : ''}">${p1Score}</span>
                            <span class="text-slate-600 mx-0.5 md:mx-1">:</span>
                            <span class="${p2Score > p1Score ? 'text-sky-400' : ''}">${p2Score}</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-end gap-3 flex-1 min-w-0 text-right">
                        <span class="font-bold text-sky-400/80 truncate">MCI</span>
                        <div class="w-1.5 h-8 rounded-full flex-shrink-0 ${p2Score > p1Score ? 'bg-sky-500 shadow-[0_0_10px_rgba(14,165,233,0.5)]' : 'bg-slate-700'}"></div>
                    </div>
                    ${deleteBtn}
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        // --- Delete Logic ---
        function deleteMatch(index) {
            matchIndexToDelete = index;
            const modal = document.getElementById('delete-modal');
            const content = document.getElementById('delete-modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeDeleteModal() {
            const modal = document.getElementById('delete-modal');
            const content = document.getElementById('delete-modal-content');
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                matchIndexToDelete = -1;
            }, 300);
        }

        function confirmDelete() {
            if (matchIndexToDelete === -1) return;
            if (historyData[selectedDateKey]) {
                historyData[selectedDateKey].splice(matchIndexToDelete, 1);
                saveData();       
                renderMatchList(); 
            }
            closeDeleteModal();
        }

        function addMatch() {
            const p1In = document.getElementById('input-p1');
            const p2In = document.getElementById('input-p2');
            const s1 = parseInt(p1In.value);
            const s2 = parseInt(p2In.value);

            if (isNaN(s1) || isNaN(s2)) {
                // Shake animation or error indication could go here
                return;
            }

            if (!historyData[selectedDateKey]) {
                historyData[selectedDateKey] = [];
            }

            historyData[selectedDateKey].push({
                p1: s1, 
                p2: s2,
                timestamp: Date.now()
            });

            p1In.value = "";
            p2In.value = "";
            p1In.focus();
            saveData();
            renderMatchList();
        }
    </script>
</body>
</html>
