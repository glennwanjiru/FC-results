<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FC Rivalry: Spurs vs City</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&family=Inter:wght@400;600&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        h1, h2, .stat-value {
            font-family: 'Teko', sans-serif;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }

        .calendar-day {
            transition: all 0.2s ease;
        }
        .calendar-day:hover:not(.empty) {
            transform: translateY(-2px);
            border-color: #3b82f6;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4">

    <!-- Header & Overall Stats -->
    <div class="w-full max-w-4xl space-y-6">
        
        <header class="text-center space-y-2 mb-8">
            <div class="flex items-center justify-center space-x-3 text-emerald-400">
                <i data-lucide="gamepad-2" class="w-8 h-8"></i>
                <span class="text-sm font-bold tracking-widest uppercase">FC Mobile</span>
            </div>
            <h1 class="text-6xl font-bold text-white tracking-wide">RIVALRY TABLE</h1>
            <p class="text-slate-400">Tottenham vs Manchester City</p>
        </header>

        <!-- The Scoreboard -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- P1 Card -->
            <div class="glass-panel rounded-2xl p-6 text-center border-t-4 border-white relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i data-lucide="shield" class="w-24 h-24"></i>
                </div>
                <h2 class="text-3xl text-white mb-2">TOTTENHAM</h2>
                <div class="text-6xl font-bold text-white mb-2" id="total-p1-goals">0</div>
                <p class="text-sm text-slate-400 uppercase tracking-widest">Total Goals</p>
                <div class="mt-4 flex justify-center space-x-4 text-sm font-mono">
                    <span class="bg-slate-800 px-3 py-1 rounded">W: <span id="p1-wins" class="text-green-400">0</span></span>
                </div>
            </div>

            <!-- VS / Aggregate -->
            <div class="flex flex-col items-center justify-center text-center space-y-4">
                <div class="text-2xl font-bold text-slate-500">OVERALL AGGREGATE</div>
                <div class="glass-panel px-8 py-4 rounded-full border border-slate-700">
                    <span class="text-4xl font-bold text-white" id="agg-score">0 : 0</span>
                </div>
                <div class="text-sm text-slate-400">Matches Played: <span id="total-matches" class="text-white">0</span></div>
            </div>

            <!-- P2 Card -->
            <div class="glass-panel rounded-2xl p-6 text-center border-t-4 border-sky-400 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i data-lucide="swords" class="w-24 h-24"></i>
                </div>
                <h2 class="text-3xl text-sky-400 mb-2">MAN CITY</h2>
                <div class="text-6xl font-bold text-white mb-2" id="total-p2-goals">0</div>
                <p class="text-sm text-slate-400 uppercase tracking-widest">Total Goals</p>
                <div class="mt-4 flex justify-center space-x-4 text-sm font-mono">
                    <span class="bg-slate-800 px-3 py-1 rounded">W: <span id="p2-wins" class="text-sky-400">0</span></span>
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="glass-panel rounded-2xl p-6 mt-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="current-month-display">Month Year</h3>
                <div class="flex space-x-2">
                    <button onclick="changeMonth(-1)" class="p-2 hover:bg-slate-700 rounded-lg"><i data-lucide="chevron-left"></i></button>
                    <button onclick="changeMonth(1)" class="p-2 hover:bg-slate-700 rounded-lg"><i data-lucide="chevron-right"></i></button>
                </div>
            </div>

            <div class="grid grid-cols-7 gap-2 mb-2 text-center text-sm font-bold text-slate-500 uppercase tracking-wider">
                <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
            </div>
            <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                <!-- Calendar generated by JS -->
            </div>
        </div>
    </div>

    <!-- Match Modal -->
    <div id="match-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md p-6 m-4 shadow-2xl transform scale-95 transition-transform duration-300" id="modal-content">
            
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-white" id="modal-date-title">Date</h3>
                    <p class="text-slate-400 text-sm" id="modal-status">Viewing History</p>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-white"><i data-lucide="x"></i></button>
            </div>

            <!-- Matches List for Selected Date -->
            <div id="matches-list" class="space-y-3 mb-6 max-h-60 overflow-y-auto">
                <!-- Populated by JS -->
            </div>

            <!-- Add Match Form (Only shows if Today) -->
            <div id="add-match-form" class="border-t border-slate-700 pt-6">
                <h4 class="text-sm font-bold text-emerald-400 uppercase tracking-widest mb-4">Add New Result</h4>
                <div class="flex items-center justify-between space-x-4 mb-4">
                    <div class="text-center w-1/3">
                        <label class="block text-xs text-slate-400 mb-1">Spurs</label>
                        <input type="number" id="input-p1" min="0" class="w-full bg-slate-800 border border-slate-600 rounded-lg py-2 text-center text-2xl focus:ring-2 focus:ring-emerald-500 outline-none">
                    </div>
                    <span class="text-slate-500 font-bold text-xl">:</span>
                    <div class="text-center w-1/3">
                        <label class="block text-xs text-slate-400 mb-1">City</label>
                        <input type="number" id="input-p2" min="0" class="w-full bg-slate-800 border border-slate-600 rounded-lg py-2 text-center text-2xl focus:ring-2 focus:ring-sky-500 outline-none">
                    </div>
                </div>
                <button onclick="addMatch()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded-lg flex items-center justify-center space-x-2 transition">
                    <i data-lucide="plus-circle" class="w-5 h-5"></i>
                    <span>Record Score</span>
                </button>
            </div>
            
            <div id="locked-message" class="hidden border-t border-slate-700 pt-6 text-center">
                <p class="text-yellow-500 flex items-center justify-center gap-2">
                    <i data-lucide="lock" class="w-4 h-4"></i>
                    Past dates are locked.
                </p>
            </div>

        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        <div class="bg-slate-900 border border-red-900/50 rounded-xl p-6 shadow-2xl transform scale-95 transition-transform duration-300 w-80 text-center" id="delete-modal-content">
            <div class="mb-4 text-red-500 flex justify-center">
                <i data-lucide="alert-triangle" class="w-12 h-12"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Delete Result?</h3>
            <p class="text-slate-400 text-sm mb-6">This action cannot be undone.</p>
            <div class="flex space-x-3 justify-center">
                <button onclick="closeDeleteModal()" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition">Cancel</button>
                <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg transition">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration & State ---
        const TEAMS = { p1: "Tottenham", p2: "City" };
        let currentDate = new Date(); // For calendar navigation
        let selectedDateKey = null;   // YYYY-MM-DD
        let historyData = {};         // Object to hold all matches
        let matchIndexToDelete = -1;  // Track which match to delete

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadData();
            
            // Render first view
            renderCalendar();
            updateDashboard();
        });

        // --- Data Management ---
        function loadData() {
            const saved = localStorage.getItem('fc_rivalry_data');
            if (saved) {
                historyData = JSON.parse(saved);
            } else {
                seedInitialData();
            }
        }

        function saveData() {
            localStorage.setItem('fc_rivalry_data', JSON.stringify(historyData));
            updateDashboard();
            renderCalendar(); // Update indicators
        }

        // Initialize with the data provided in the prompt
        function seedInitialData() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const dayBeforeYesterday = new Date(today);
            dayBeforeYesterday.setDate(dayBeforeYesterday.getDate() - 2);

            const yestKey = formatDateKey(yesterday);
            const dayBeforeYestKey = formatDateKey(dayBeforeYesterday);

            historyData = {};

            // Day Before Yesterday: Aggregate Tot 2 : City 3
            historyData[dayBeforeYestKey] = [
                { p1: 2, p2: 3, timestamp: Date.now() - 172800000 }
            ];

            // Yesterday: 1:1, 3:2, 1:0, 2:2, 1:1
            historyData[yestKey] = [
                { p1: 1, p2: 1, timestamp: Date.now() - 86400000 },
                { p1: 3, p2: 2, timestamp: Date.now() - 86399999 },
                { p1: 1, p2: 0, timestamp: Date.now() - 86399998 },
                { p1: 2, p2: 2, timestamp: Date.now() - 86399997 },
                { p1: 1, p2: 1, timestamp: Date.now() - 86399996 }
            ];

            // Today is left empty for new games
            
            saveData();
            console.log("Initial data seeded (Corrected Timeline)");
        }

        // --- Helper Functions ---
        function formatDateKey(dateObj) {
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getTodayKey() {
            return formatDateKey(new Date());
        }

        // --- Dashboard Logic ---
        function updateDashboard() {
            let p1Goals = 0, p2Goals = 0;
            let p1Wins = 0, p2Wins = 0, matches = 0;

            Object.values(historyData).forEach(dayMatches => {
                dayMatches.forEach(m => {
                    matches++;
                    p1Goals += parseInt(m.p1);
                    p2Goals += parseInt(m.p2);
                    if(m.p1 > m.p2) p1Wins++;
                    else if (m.p2 > m.p1) p2Wins++;
                });
            });

            // Animate numbers (simple logic)
            document.getElementById('total-p1-goals').textContent = p1Goals;
            document.getElementById('total-p2-goals').textContent = p2Goals;
            document.getElementById('agg-score').textContent = `${p1Goals} : ${p2Goals}`;
            document.getElementById('p1-wins').textContent = p1Wins;
            document.getElementById('p2-wins').textContent = p2Wins;
            document.getElementById('total-matches').textContent = matches;
        }

        // --- Calendar Logic ---
        function changeMonth(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            renderCalendar();
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Display Title
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('current-month-display').innerText = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = "";

            // Empty slots for days before start of month
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day empty p-4';
                grid.appendChild(empty);
            }

            const todayKey = getTodayKey();

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(year, month, day);
                const dateKey = formatDateKey(dateObj);
                const hasData = historyData[dateKey] && historyData[dateKey].length > 0;
                
                const el = document.createElement('div');
                let classes = "calendar-day bg-slate-800 rounded-lg p-2 h-24 flex flex-col justify-between border border-slate-700 relative";
                
                if (dateKey === todayKey) {
                    classes += " ring-2 ring-emerald-500 bg-slate-800/50";
                }

                el.className = classes;
                el.onclick = () => openModal(dateKey);

                // Date Number
                let content = `<span class="font-bold text-slate-400 ${dateKey === todayKey ? 'text-emerald-400' : ''}">${day}</span>`;

                // Indicators if matches played
                if (hasData) {
                    const count = historyData[dateKey].length;
                    
                    // Mini Score Summary for that day
                    let dayP1 = 0, dayP2 = 0;
                    historyData[dateKey].forEach(m => { dayP1+=m.p1; dayP2+=m.p2; });

                    content += `
                        <div class="mt-1">
                            <div class="text-xs text-center bg-slate-900 rounded py-1 mb-1 font-mono">
                                ${dayP1} - ${dayP2}
                            </div>
                            <div class="flex justify-center gap-0.5">
                                ${Array(Math.min(count, 5)).fill(0).map(() => `<div class="w-1 h-1 rounded-full bg-sky-400"></div>`).join('')}
                                ${count > 5 ? '<span class="text-[8px] leading-none">+</span>' : ''}
                            </div>
                        </div>
                    `;
                }

                el.innerHTML = content;
                grid.appendChild(el);
            }
        }

        // --- Modal & Form Logic ---
        function openModal(dateKey) {
            selectedDateKey = dateKey;
            const modal = document.getElementById('match-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            // Small timeout to allow transition
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);

            // Set Title
            const d = new Date(selectedDateKey);
            document.getElementById('modal-date-title').innerText = d.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            // Check if Editable
            const todayKey = getTodayKey();
            const isToday = (selectedDateKey === todayKey);
            const isFuture = (selectedDateKey > todayKey); // Basic string comparison works for ISO YYYY-MM-DD

            const formDiv = document.getElementById('add-match-form');
            const lockedMsg = document.getElementById('locked-message');
            const statusTxt = document.getElementById('modal-status');

            if (isToday) {
                formDiv.classList.remove('hidden');
                lockedMsg.classList.add('hidden');
                statusTxt.innerText = "Today's Games - Editable";
                statusTxt.className = "text-emerald-400 text-sm font-bold";
            } else {
                formDiv.classList.add('hidden');
                lockedMsg.classList.remove('hidden');
                if(isFuture) {
                    statusTxt.innerText = "Future Date";
                    lockedMsg.innerHTML = `<p class="text-slate-500">Cannot predict the future.</p>`;
                } else {
                    statusTxt.innerText = "Past Record - Locked";
                    statusTxt.className = "text-slate-500 text-sm";
                    lockedMsg.innerHTML = `<p class="text-yellow-500 flex items-center justify-center gap-2"><i data-lucide="lock" class="w-4 h-4"></i> Day passed. Rivalry book closed.</p>`;
                }
            }

            renderMatchList();
        }

        function closeModal() {
            const modal = document.getElementById('match-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function renderMatchList() {
            const list = document.getElementById('matches-list');
            list.innerHTML = "";
            
            const matches = historyData[selectedDateKey] || [];
            const isToday = (selectedDateKey === getTodayKey());

            if (matches.length === 0) {
                list.innerHTML = `<div class="text-center text-slate-600 italic py-4">No matches recorded.</div>`;
                return;
            }

            matches.forEach((m, index) => {
                const p1Score = parseInt(m.p1);
                const p2Score = parseInt(m.p2);
                
                let borderColor = "border-slate-700";
                if(p1Score > p2Score) borderColor = "border-l-4 border-l-white border-y border-r-slate-700"; // Spurs win
                else if (p2Score > p1Score) borderColor = "border-l-4 border-l-sky-400 border-y border-r-slate-700"; // City win
                else borderColor = "border-slate-600"; // Draw

                const div = document.createElement('div');
                // Added 'group' and 'relative' for positioning the delete button
                div.className = `flex justify-between items-center bg-slate-800 p-3 rounded ${borderColor} relative group`;
                
                let deleteBtn = '';
                if (isToday) {
                    deleteBtn = `
                        <button onclick="deleteMatch(${index})" class="absolute right-2 opacity-0 group-hover:opacity-100 transition-opacity text-slate-500 hover:text-red-500 bg-slate-800 p-1 rounded-full shadow-lg border border-slate-700 z-10">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    `;
                }

                div.innerHTML = `
                    <div class="font-bold text-white w-1/3 text-left">TOT</div>
                    <div class="font-mono text-xl bg-slate-900 px-3 py-1 rounded text-white tracking-widest">
                        ${p1Score} - ${p2Score}
                    </div>
                    <div class="font-bold text-sky-400 w-1/3 text-right ${isToday ? 'pr-8' : ''}">MCI</div>
                    ${deleteBtn}
                `;
                list.appendChild(div);
            });
            
            // Refresh icons for the new delete buttons
            lucide.createIcons();
        }

        function deleteMatch(index) {
            matchIndexToDelete = index;
            const modal = document.getElementById('delete-modal');
            const content = document.getElementById('delete-modal-content');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeDeleteModal() {
            const modal = document.getElementById('delete-modal');
            const content = document.getElementById('delete-modal-content');
            
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                matchIndexToDelete = -1;
            }, 300);
        }

        function confirmDelete() {
            if (matchIndexToDelete === -1) return;
            
            if (historyData[selectedDateKey]) {
                historyData[selectedDateKey].splice(matchIndexToDelete, 1);
                saveData();       // Updates LocalStorage & Dashboard totals
                renderMatchList(); // Refreshes the list to remove the item
            }
            closeDeleteModal();
        }

        function addMatch() {
            const p1In = document.getElementById('input-p1');
            const p2In = document.getElementById('input-p2');

            const s1 = parseInt(p1In.value);
            const s2 = parseInt(p2In.value);

            if (isNaN(s1) || isNaN(s2)) {
                alert("Please enter valid scores!");
                return;
            }

            if (!historyData[selectedDateKey]) {
                historyData[selectedDateKey] = [];
            }

            historyData[selectedDateKey].push({
                p1: s1, 
                p2: s2,
                timestamp: Date.now()
            });

            // Reset Inputs
            p1In.value = "";
            p2In.value = "";
            p1In.focus();

            saveData();
            renderMatchList();
        }

    </script>
</body>
</html>
